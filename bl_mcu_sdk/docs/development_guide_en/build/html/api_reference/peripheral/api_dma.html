

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2.5. DMA &mdash; BL_MCU_SDK Development Guide 0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.6. I2C" href="api_i2c.html" />
    <link rel="prev" title="2.4. PWM" href="api_pwm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> BL_MCU_SDK Development Guide
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Development Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/get_started.html">1. Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/connecting_hardware.html">2. Hardware connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/index.html">3. Development environment setup guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/cmake_quick_start.html">4. New Project Guide based on cmake framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/cdk_new_project_quick_start.html">5. New Project Guide based on CDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/bl_dev_cube.html">6. BLDevCube start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/board.html">7. Board Configuration System User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">API Manuals</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api_overview.html">1. API Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Peripheral</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api_clock.html">2.1. Clock Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_gpio.html">2.2. GPIO Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_uart.html">2.3. UART Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_pwm.html">2.4. PWM Device</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.5. DMA Device</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">2.5.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dma-device-structure-definition">2.5.2. DMA Device Structure Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dma-device-parameter-configuration-table">2.5.3. DMA Device Parameter Configuration Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dma-device-interface">2.5.4. DMA Device Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dma-register">2.5.4.1. <strong>dma_register</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-open">2.5.4.2. <strong>device_open</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-close">2.5.4.3. <strong>device_close</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-control">2.5.4.4. <strong>device_control</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#device-set-callback">2.5.4.5. <strong>device_set_callback</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#dma-channel-start">2.5.4.6. <strong>dma_channel_start</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#dma-channel-stop">2.5.4.7. <strong>dma_channel_stop</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#dma-channel-update">2.5.4.8. <strong>dma_channel_update</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#dma-channel-check-busy">2.5.4.9. <strong>dma_channel_check_busy</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#dma-reload">2.5.4.10. <strong>dma_reload</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api_i2c.html">2.6. I2C Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_spi.html">2.7. SPI Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_adc.html">2.8. ADC Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_dac.html">2.9. DAC Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_timer.html">2.10. TIMER Device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth/api_ble.html">3. BLE</a></li>
</ul>
<p class="caption"><span class="caption-text">Basic Peripheral Samples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/gpio/index.html">1. GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/uart/index.html">2. UART</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/pwm/index.html">3. PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/mtimer/index.html">4. MTIMER</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/dma/index.html">5. DMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/spi/index.html">6. SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/i2c/index.html">7. I2C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/adc/index.html">8. ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/basic%20samples/timer/index.html">9. TIMER</a></li>
</ul>
<p class="caption"><span class="caption-text">Advance Samples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../samples/advance%20samples/shell_demo.html">1. SHELL Command Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/advance%20samples/fatfs_demo.html">2. FATFS Read And Write</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/advance%20samples/lowpower_demo.html">3. LowPower Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/advance%20samples/boot2_iap_info.html">4. BOOT2 IAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/advance%20samples/ble_scan_demo.html">5. BLE Client And Server Interconnection</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BL_MCU_SDK Development Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2. </span>Peripheral</a> &raquo;</li>
        
      <li><span class="section-number">2.5. </span>DMA</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/api_reference/peripheral/api_dma.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dma">
<h1><span class="section-number">2.5. </span>DMA<a class="headerlink" href="#dma" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">2.5.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h2>
<p>DMA is a memory access technology that can directly read and write system memory independently without processor intervention. Under the same degree of processor burden, DMA is a fast data transfer method. The DMA device in BL series MCU has the following characteristics:</p>
<ul class="simple">
<li><p>8 independent dedicated channels</p></li>
<li><p>Four transmission directions: memory to memory, memory to peripheral, peripheral to memory, peripheral to peripheral</p></li>
<li><p>LLI linked list</p></li>
</ul>
</div>
<div class="section" id="dma-device-structure-definition">
<h2><span class="section-number">2.5.2. </span>DMA Device Structure Definition<a class="headerlink" href="#dma-device-structure-definition" title="Permalink to this headline">Â¶</a></h2>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">dma_device</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="nc">device</span> <span class="n">parent</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">id</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">ch</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">direction</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">transfer_mode</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">src_req</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">dst_req</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">src_burst_size</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">dst_burst_size</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">src_width</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">dst_width</span><span class="p">;</span>
    <span class="n">dma_lli_ctrl_t</span> <span class="o">*</span><span class="n">lli_cfg</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dma_device_t</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>parent</strong>            inherits the properties of the parent class</p></li>
<li><p><strong>id</strong>                DMA id number, default 0, currently there is only one DMA</p></li>
<li><p><strong>ch</strong>                channel number</p></li>
<li><p><strong>direction</strong>         transmission direction</p></li>
<li><p><strong>transfer_mode</strong>     transfer mode</p></li>
<li><p><strong>src_req</strong>           source request</p></li>
<li><p><strong>dst_req</strong>           destination request</p></li>
<li><p><strong>src_burst_size</strong>    source burst bytes</p></li>
<li><p><strong>dst_burst_size</strong>    destination number of burst bytes</p></li>
<li><p><strong>src_width</strong>         source transmission bit width</p></li>
<li><p><strong>dst_width</strong>         destination transmission bit width</p></li>
<li><p><strong>lli_cfg</strong>           used to store some information of the dma channel, the user does not need to worry about it</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">direction</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
    <span class="n">DMA_MEMORY_TO_MEMORY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>                        <span class="cm">/*!&lt; DMA transfer tyep:memory to memory */</span>
    <span class="n">DMA_MEMORY_TO_PERIPH</span><span class="p">,</span>                            <span class="cm">/*!&lt; DMA transfer tyep:memory to peripheral */</span>
    <span class="n">DMA_PERIPH_TO_MEMORY</span><span class="p">,</span>                            <span class="cm">/*!&lt; DMA transfer tyep:peripheral to memory */</span>
    <span class="n">DMA_PERIPH_TO_PERIPH</span><span class="p">,</span>                            <span class="cm">/*!&lt; DMA transfer tyep:peripheral to peripheral */</span>
<span class="p">}</span><span class="n">dma_transfer_dir_type</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">transfer_mode</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_LLI_ONCE_MODE     0</span>
<span class="cp">#define DMA_LLI_CYCLE_MODE    1</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">src_req</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_REQUEST_NONE        0x00000000 </span><span class="cm">/*!&lt; DMA request peripheral:None */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART0_RX    0x00000000 </span><span class="cm">/*!&lt; DMA request peripheral:UART0 RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART0_TX    0x00000001 </span><span class="cm">/*!&lt; DMA request peripheral:UART0 TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART1_RX    0x00000002 </span><span class="cm">/*!&lt; DMA request peripheral:UART1 RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART1_TX    0x00000003 </span><span class="cm">/*!&lt; DMA request peripheral:UART1 TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2C0_RX     0x00000006 </span><span class="cm">/*!&lt; DMA request peripheral:I2C RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2C0_TX     0x00000007 </span><span class="cm">/*!&lt; DMA request peripheral:I2C TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_SPI0_RX     0x0000000A </span><span class="cm">/*!&lt; DMA request peripheral:SPI RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_SPI0_TX     0x0000000B </span><span class="cm">/*!&lt; DMA request peripheral:SPI TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2S_RX      0x00000014 </span><span class="cm">/*!&lt; DMA request peripheral:I2S RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2S_TX      0x00000015 </span><span class="cm">/*!&lt; DMA request peripheral:I2S TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_ADC0        0x00000016 </span><span class="cm">/*!&lt; DMA request peripheral:ADC0 */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_DAC0        0x00000017 </span><span class="cm">/*!&lt; DMA request peripheral:DAC0 */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP0     0x00000018 </span><span class="cm">/*!&lt; DMA request peripheral:USB EP0*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP1     0x00000019 </span><span class="cm">/*!&lt; DMA request peripheral:USB EP1*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP2     0x0000001A </span><span class="cm">/*!&lt; DMA request peripheral:USB EP2*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP3     0x0000001B </span><span class="cm">/*!&lt; DMA request peripheral:USB EP3*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP4     0x0000001C </span><span class="cm">/*!&lt; DMA request peripheral:USB EP4*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP5     0x0000001D </span><span class="cm">/*!&lt; DMA request peripheral:USB EP5*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP6     0x0000001E </span><span class="cm">/*!&lt; DMA request peripheral:USB EP6*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP7     0x0000001F </span><span class="cm">/*!&lt; DMA request peripheral:USB EP7 */</span><span class="cp"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dst_req</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_REQUEST_NONE        0x00000000 </span><span class="cm">/*!&lt; DMA request peripheral:None */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART0_RX    0x00000000 </span><span class="cm">/*!&lt; DMA request peripheral:UART0 RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART0_TX    0x00000001 </span><span class="cm">/*!&lt; DMA request peripheral:UART0 TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART1_RX    0x00000002 </span><span class="cm">/*!&lt; DMA request peripheral:UART1 RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_UART1_TX    0x00000003 </span><span class="cm">/*!&lt; DMA request peripheral:UART1 TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2C0_RX     0x00000006 </span><span class="cm">/*!&lt; DMA request peripheral:I2C RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2C0_TX     0x00000007 </span><span class="cm">/*!&lt; DMA request peripheral:I2C TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_SPI0_RX     0x0000000A </span><span class="cm">/*!&lt; DMA request peripheral:SPI RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_SPI0_TX     0x0000000B </span><span class="cm">/*!&lt; DMA request peripheral:SPI TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2S_RX      0x00000014 </span><span class="cm">/*!&lt; DMA request peripheral:I2S RX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_I2S_TX      0x00000015 </span><span class="cm">/*!&lt; DMA request peripheral:I2S TX */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_ADC0        0x00000016 </span><span class="cm">/*!&lt; DMA request peripheral:ADC0 */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_DAC0        0x00000017 </span><span class="cm">/*!&lt; DMA request peripheral:DAC0 */</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP0     0x00000018 </span><span class="cm">/*!&lt; DMA request peripheral:USB EP0*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP1     0x00000019 </span><span class="cm">/*!&lt; DMA request peripheral:USB EP1*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP2     0x0000001A </span><span class="cm">/*!&lt; DMA request peripheral:USB EP2*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP3     0x0000001B </span><span class="cm">/*!&lt; DMA request peripheral:USB EP3*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP4     0x0000001C </span><span class="cm">/*!&lt; DMA request peripheral:USB EP4*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP5     0x0000001D </span><span class="cm">/*!&lt; DMA request peripheral:USB EP5*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP6     0x0000001E </span><span class="cm">/*!&lt; DMA request peripheral:USB EP6*/</span><span class="cp"></span>
<span class="cp">#define DMA_REQUEST_USB_EP7     0x0000001F </span><span class="cm">/*!&lt; DMA request peripheral:USB EP7 */</span><span class="cp"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">src_burst_size</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_BURST_1BYTE     0</span>
<span class="cp">#define DMA_BURST_4BYTE     1</span>
<span class="cp">#define DMA_BURST_8BYTE     2</span>
<span class="cp">#define DMA_BURST_16BYTE    3</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dst_burst_size</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_BURST_1BYTE     0</span>
<span class="cp">#define DMA_BURST_4BYTE     1</span>
<span class="cp">#define DMA_BURST_8BYTE     2</span>
<span class="cp">#define DMA_BURST_16BYTE    3</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">src_width</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_TRANSFER_WIDTH_8BIT  0</span>
<span class="cp">#define DMA_TRANSFER_WIDTH_16BIT 1</span>
<span class="cp">#define DMA_TRANSFER_WIDTH_32BIT 2</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dst_width</span></code>: provide the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_TRANSFER_WIDTH_8BIT  0</span>
<span class="cp">#define DMA_TRANSFER_WIDTH_16BIT 1</span>
<span class="cp">#define DMA_TRANSFER_WIDTH_32BIT 2</span>
</pre></div>
</div>
</div>
<div class="section" id="dma-device-parameter-configuration-table">
<h2><span class="section-number">2.5.3. </span>DMA Device Parameter Configuration Table<a class="headerlink" href="#dma-device-parameter-configuration-table" title="Permalink to this headline">Â¶</a></h2>
<p>Each DMA device has a parameter configuration macro, the macro definition is located in the <code class="docutils literal notranslate"><span class="pre">peripheral_config.h</span></code> file under the <code class="docutils literal notranslate"><span class="pre">bsp/board/xxx</span></code> directory, and the variable definition is located in <code class="docutils literal notranslate"><span class="pre">hal_dma.c</span></code>, so there is no need for the user himself Define variables. When the user opens the macro of the corresponding device, the configuration of the device will take effect. For example, open the macro <code class="docutils literal notranslate"><span class="pre">BSP_USING_DMA0_CH0</span></code>, <code class="docutils literal notranslate"><span class="pre">DMA0_CH0_CONFIG</span></code> will take effect, and the DMA channel 0 device can be registered and used.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cm">/*Parameter configuration macro*/</span>
<span class="cp">#if defined(BSP_USING_DMA0_CH0)</span>
<span class="cp">#ifndef DMA0_CH0_CONFIG</span>
<span class="cp">#define DMA0_CH0_CONFIG \</span>
<span class="cp">{   \</span>
<span class="cp"> .id = 0, \</span>
<span class="cp"> .ch = 0,\</span>
<span class="cp"> .direction = DMA_MEMORY_TO_MEMORY,\</span>
<span class="cp"> .transfer_mode = DMA_LLI_ONCE_MODE, \</span>
<span class="cp"> .src_req = DMA_REQUEST_NONE, \</span>
<span class="cp"> .dst_req = DMA_REQUEST_NONE, \</span>
<span class="cp"> .src_width = DMA_TRANSFER_WIDTH_32BIT , \</span>
<span class="cp"> .dst_width = DMA_TRANSFER_WIDTH_32BIT , \</span>
<span class="cp">}</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>


<span class="cm">/*Variable definitions*/</span>
<span class="k">static</span> <span class="n">dma_device_t</span> <span class="n">dmax_device</span><span class="p">[</span><span class="n">DMA_MAX_INDEX</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH0</span>
    <span class="n">DMA0_CH0_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH1</span>
    <span class="n">DMA0_CH1_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH2</span>
    <span class="n">DMA0_CH2_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH3</span>
    <span class="n">DMA0_CH3_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH4</span>
    <span class="n">DMA0_CH4_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH5</span>
    <span class="n">DMA0_CH5_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH6</span>
    <span class="n">DMA0_CH6_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH7</span>
    <span class="n">DMA0_CH7_CONFIG</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above configuration can be modified through <code class="docutils literal notranslate"><span class="pre">DMA_DEV(dev)-&gt;xxx</span></code> and can only be used before calling <code class="docutils literal notranslate"><span class="pre">device_open</span></code>.</p>
</div>
</div>
<div class="section" id="dma-device-interface">
<h2><span class="section-number">2.5.4. </span>DMA Device Interface<a class="headerlink" href="#dma-device-interface" title="Permalink to this headline">Â¶</a></h2>
<p>The DMA device interface follows which provided by the standard device driver management layer. In order to facilitate the user to call, some standard interfaces are redefined using macros.</p>
<div class="section" id="dma-register">
<h3><span class="section-number">2.5.4.1. </span><strong>dma_register</strong><a class="headerlink" href="#dma-register" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dma_register</span></code> is used to register a DMA device standard driver interface. Before registering, you need to open the channel macro definition of the corresponding DMA device. For example, after defining the macro <code class="docutils literal notranslate"><span class="pre">BSP_USING_DMA_CH0</span></code>, the 0 channel of the <code class="docutils literal notranslate"><span class="pre">DMA</span></code> device can be used. After the registration is completed, other interfaces can be used. If the macro is not defined, the 0 channel of the <code class="docutils literal notranslate"><span class="pre">DMA</span></code> device cannot be used.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">dma_register</span><span class="p">(</span><span class="k">enum</span> <span class="n">dma_index_type</span> <span class="n">index</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>index</strong> device index to be registered</p></li>
<li><p><strong>name</strong> device name to be registered</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">index</span></code> is used to select the configuration of a certain channel of DMA, an index corresponds to a channel configuration of a DMA, for example, <code class="docutils literal notranslate"><span class="pre">DMA_CH0_INDEX</span></code> corresponds to the configuration of DMA channel 0, and <code class="docutils literal notranslate"><span class="pre">index</span></code> has the following optional types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">dma_index_type</span>
<span class="p">{</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH0</span>
    <span class="n">DMA0_CH0_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH1</span>
    <span class="n">DMA0_CH1_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH2</span>
    <span class="n">DMA0_CH2_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH3</span>
    <span class="n">DMA0_CH3_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH4</span>
    <span class="n">DMA0_CH4_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH5</span>
    <span class="n">DMA0_CH5_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH6</span>
    <span class="n">DMA0_CH6_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef BSP_USING_DMA0_CH7</span>
    <span class="n">DMA0_CH7_INDEX</span><span class="p">,</span>
<span class="cp">#endif</span>
    <span class="n">DMA_MAX_INDEX</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="device-open">
<h3><span class="section-number">2.5.4.2. </span><strong>device_open</strong><a class="headerlink" href="#device-open" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">device_open</span></code> is used to open a channel of a dma device,this funtion calls <code class="docutils literal notranslate"><span class="pre">dma_open</span></code> actually.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">device_open</span><span class="p">(</span><span class="k">struct</span> <span class="nc">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">oflag</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> device handle</p></li>
<li><p><strong>oflag</strong> open mode</p></li>
<li><p><strong>return</strong> Error code, 0 means opening is successful, other means error</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">oflag</span></code> provides the following types</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DEVICE_OFLAG_STREAM_TX  0x001 </span><span class="cm">/* The device is turned on in polling sending mode */</span><span class="cp"></span>
<span class="cp">#define DEVICE_OFLAG_STREAM_RX  0x002 </span><span class="cm">/* The device is turned on in polling receiving mode */</span><span class="cp"></span>
<span class="cp">#define DEVICE_OFLAG_INT_TX     0x004 </span><span class="cm">/* The device is turned on in interrupt sending mode */</span><span class="cp"></span>
<span class="cp">#define DEVICE_OFLAG_INT_RX     0x008 </span><span class="cm">/* The device is turned on in interrupt receiving mode */</span><span class="cp"></span>
<span class="cp">#define DEVICE_OFLAG_DMA_TX     0x010 </span><span class="cm">/* The device is turned on in DMA transmission mode */</span><span class="cp"></span>
<span class="cp">#define DEVICE_OFLAG_DMA_RX     0x020 </span><span class="cm">/* The device is turned on in DMA receiving mode */</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="device-close">
<h3><span class="section-number">2.5.4.3. </span><strong>device_close</strong><a class="headerlink" href="#device-close" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">device_close</span></code> is used to close a channel of a dma device,this funtion calls <code class="docutils literal notranslate"><span class="pre">dma_close</span></code> actually.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">device_close</span><span class="p">(</span><span class="k">struct</span> <span class="nc">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> device handle</p></li>
<li><p><strong>return</strong> error code, 0 means closing is successful, others mean error</p></li>
</ul>
</div>
<div class="section" id="device-control">
<h3><span class="section-number">2.5.4.4. </span><strong>device_control</strong><a class="headerlink" href="#device-control" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">device_control</span></code> is used to control and modify the parameters of the dma device according to commands.This funtion calls <code class="docutils literal notranslate"><span class="pre">dma_control</span></code> actually.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">device_control</span><span class="p">(</span><span class="k">struct</span> <span class="nc">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> device handle</p></li>
<li><p><strong>cmd</strong> device control command</p></li>
<li><p><strong>args</strong> control parameters</p></li>
<li><p><strong>return</strong> different control commands return different meanings</p></li>
</ul>
<p>In addition to standard control commands, DMA devices also have their own special control commands.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define DMA_CHANNEL_GET_STATUS  0x10</span>
<span class="cp">#define DMA_CHANNEL_START       0x11</span>
<span class="cp">#define DMA_CHANNEL_STOP        0x12</span>
<span class="cp">#define DMA_CHANNEL_UPDATE      0x13</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">args</span></code> input is different depending on <code class="docutils literal notranslate"><span class="pre">cmd</span></code>, the list is as follows:</p>
<table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">table1</span><a class="headerlink" href="#id1" title="Permalink to this table">Â¶</a></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 18%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>cmd</p></th>
<th class="head"><p>args</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DEVICE_CTRL_SET_INT</p></td>
<td><p>NULL</p></td>
<td><p>Enable DMA transfer completion interrupt</p></td>
</tr>
<tr class="row-odd"><td><p>DEVICE_CTRL_CLR_INT</p></td>
<td><p>NULL</p></td>
<td><p>Disable DMA transfer completion interrupt</p></td>
</tr>
<tr class="row-even"><td><p>DMA_CHANNEL_GET_STATUS</p></td>
<td><p>NULL</p></td>
<td><p>Get DMA channel completion status</p></td>
</tr>
<tr class="row-odd"><td><p>DMA_CHANNEL_START</p></td>
<td><p>NULL</p></td>
<td><p>Open dma channel</p></td>
</tr>
<tr class="row-even"><td><p>DMA_CHANNEL_STOP</p></td>
<td><p>NULL</p></td>
<td><p>Close dma channel</p></td>
</tr>
<tr class="row-odd"><td><p>DMA_CHANNEL_UPDATE</p></td>
<td><p>NULL</p></td>
<td><p>Update dma transmission configuration</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="device-set-callback">
<h3><span class="section-number">2.5.4.5. </span><strong>device_set_callback</strong><a class="headerlink" href="#device-set-callback" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">device_set_callback</span></code> is used to register a DMA channel interrupt callback function.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">device_set_callback</span><span class="p">(</span><span class="k">struct</span> <span class="nc">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="k">struct</span> <span class="nc">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">event</span><span class="p">));</span>
</pre></div>
</div>
<ul>
<li><p><strong>dev</strong> Device handle</p></li>
<li><p><strong>callback</strong> The interrupt callback function to be registered</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>dev</strong> device handle</p></li>
<li><p><strong>args</strong> unused</p></li>
<li><p><strong>size</strong> unused</p></li>
<li><p><strong>event</strong> interrupt event type</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">event</span></code> type definition is as follows:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">dma_event_type</span>
<span class="p">{</span>
    <span class="n">DMA_EVENT_COMPLETE</span><span class="p">,</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="dma-channel-start">
<h3><span class="section-number">2.5.4.6. </span><strong>dma_channel_start</strong><a class="headerlink" href="#dma-channel-start" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dma_channel_start</span></code> is used to open the DMA channel. It actually calls <code class="docutils literal notranslate"><span class="pre">device_control</span></code>, where <code class="docutils literal notranslate"><span class="pre">cmd</span></code> is <code class="docutils literal notranslate"><span class="pre">DMA_CHANNEL_START</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dma_channel_start</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> dma channel handle that needs to be opened</p></li>
</ul>
</div>
<div class="section" id="dma-channel-stop">
<h3><span class="section-number">2.5.4.7. </span><strong>dma_channel_stop</strong><a class="headerlink" href="#dma-channel-stop" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dma_channel_stop</span></code> is used to close the DMA channel. It actually calls <code class="docutils literal notranslate"><span class="pre">device_control</span></code>, where <code class="docutils literal notranslate"><span class="pre">cmd</span></code> is <code class="docutils literal notranslate"><span class="pre">DMA_CHANNEL_STOP</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dma_channel_stop</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> dma channel handle that needs to be closed</p></li>
</ul>
</div>
<div class="section" id="dma-channel-update">
<h3><span class="section-number">2.5.4.8. </span><strong>dma_channel_update</strong><a class="headerlink" href="#dma-channel-update" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dma_channel_update</span></code> is used to update the DMA configuration. The actual call is <code class="docutils literal notranslate"><span class="pre">device_control</span></code>, where <code class="docutils literal notranslate"><span class="pre">cmd</span></code> is <code class="docutils literal notranslate"><span class="pre">DMA_CHANNEL_UPDATE</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dma_channel_update</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">list</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> dma channel handle that needs to be updated</p></li>
<li><p><strong>list</strong> dma_lli_ctrl_t handle</p></li>
</ul>
</div>
<div class="section" id="dma-channel-check-busy">
<h3><span class="section-number">2.5.4.9. </span><strong>dma_channel_check_busy</strong><a class="headerlink" href="#dma-channel-check-busy" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dma_channel_check_busy</span></code> is used to query whether the currently used DMA channel has completed the transfer. It actually calls <code class="docutils literal notranslate"><span class="pre">device_control</span></code>, where <code class="docutils literal notranslate"><span class="pre">cmd</span></code> is <code class="docutils literal notranslate"><span class="pre">DMA_CHANNEL_GET_STATUS</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">dma_channel_check_busy</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> DMA channel handle to be queried</p></li>
<li><p><strong>return</strong> return the current DMA status, 0 means the transfer is complete, 1 means the transfer is not complete</p></li>
</ul>
</div>
<div class="section" id="dma-reload">
<h3><span class="section-number">2.5.4.10. </span><strong>dma_reload</strong><a class="headerlink" href="#dma-reload" title="Permalink to this headline">Â¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dma_reload</span></code> is used to update the configuration of a certain channel of DMA. Compared with <code class="docutils literal notranslate"><span class="pre">dma_channel_update</span></code>, this function does not require the user to pass many parameters, but only needs to fill in the source address, destination address, and length. After this function is called, the DMA channel is not turned on. You need to manually call the <code class="docutils literal notranslate"><span class="pre">dma_channel_start</span></code> function.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">dma_reload</span><span class="p">(</span><span class="k">struct</span> <span class="nc">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">src_addr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">dst_addr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">transfer_size</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>dev</strong> DMA channel handle to be queried</p></li>
<li><p><strong>src_addr</strong> transmission source address</p></li>
<li><p><strong>dst_addr</strong> transmission destination address</p></li>
<li><p><strong>transfer_size</strong> the total length of transferred bytes. If the number of bits transferred is 16 bits or 32 bits, it needs to be converted into byte length here.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="api_i2c.html" class="btn btn-neutral float-right" title="2.6. I2C" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="api_pwm.html" class="btn btn-neutral float-left" title="2.4. PWM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, BouffaloLab Co., Ltd.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>